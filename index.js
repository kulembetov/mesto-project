(()=>{"use strict";const e="144e55420d8ef04ba110.png";var t={id:"",name:""},n=document.querySelector(".cards"),r=document.querySelector("#cards-template").content,o=document.querySelector("#popup-profile"),a=document.querySelector("#popup-image-add"),c=document.querySelector("#popup-image-zoom"),i=document.querySelector("#popup-avatar"),s=document.querySelector(".profile__button-edit"),u=document.querySelector(".profile__button-add"),l=document.querySelectorAll(".popup__button-close"),d=document.querySelector(".popup__image"),f=document.querySelector(".popup__caption"),m=document.forms.profile,p=document.forms.image,v=document.forms.avatar,_=m.elements.name,y=m.elements.info,h=p.elements.title,b=p.elements.link,S=v.elements.avatar,g=document.querySelector(".profile__avatar"),E=document.querySelector(".profile__name"),L=document.querySelector(".profile__about"),k=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},q=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A),e.addEventListener("mousedown",x)},C=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A),e.removeEventListener("mousedown",x)},A=function(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))},x=function(e){e.target.classList.contains("popup_opened")&&C(e.target)};l.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){C(t)}))}));var T,U,w=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},j=function(e,t){return fetch(e,t).then(w)},O=function(e,t){var n=t.target.querySelector(".popup__button-submit");n.textContent=e?n.dataset.saving:n.dataset.save},D={baseUrl:"https://nomoreparties.co/v1/plus-cohort-20",headers:{authorization:"7705f7d6-50a3-4e15-b4ba-203407e7d971","Content-Type":"application/json"}},P=function(){return j("".concat(D.baseUrl,"/cards"),{method:"GET",headers:D.headers})},B=function(e,t){e.length>0?(t.classList.add("cards__likes-counter_active"),t.textContent=e.length):(t.classList.remove("cards__likes-counter_active"),t.textContent="")},M=function(e,n){e.forEach((function(e){e.name===t.name&&n.classList.add("cards__button-like_active")}))},N=function(n){var o,a,i=r.querySelector(".cards__item").cloneNode(!0),s=i.querySelector(".cards__image"),u=i.querySelector(".cards__title"),l=i.querySelector(".cards__button-cart"),m=i.querySelector(".cards__button-like"),p=i.querySelector(".cards__likes-counter");return u.textContent=n.name,s.src=n.link,s.alt=n.name,s.addEventListener("error",(function(){s.setAttribute("src",e)})),s.addEventListener("click",(function(){d.src=s.src,d.alt=s.alt,f.textContent=s.alt,q(c)})),m.addEventListener("click",(function(e){var t;e.target.classList.contains("cards__button-like_active")?(t=n._id,j("".concat(D.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:D.headers})).then((function(t){B(t.likes,p),M(t.likes,e.target),e.target.classList.remove("cards__button-like_active")})).catch((function(e){console.log(e)})):function(e){return j("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:D.headers})}(n._id).then((function(t){B(t.likes,p),M(t.likes,e.target)})).catch((function(e){console.log(e)}))})),l.addEventListener("click",(function(e){var t;(t=n._id,j("".concat(D.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:D.headers})).then((function(){e.target.closest(".cards__item").remove()})).catch((function(e){console.log(e)}))})),o=n.owner._id,a=l,t.id!==o&&a.remove(),B(n.likes,p),M(n.likes,m),i},I=function(e,t){t.prepend(e)};function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Promise.all([j("".concat(D.baseUrl,"/users/me"),{method:"GET",headers:D.headers}),P()]).then((function(e){var n,r,o=(n=e,r=1,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,c,i=[],s=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(u)throw o}}return i}}(n,r)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];E.textContent=o.name,L.textContent=o.about,g.src=o.avatar,t.id=o._id,t.name=o.name})).then((function(){P().then((function(e){!function(e,t){e.reverse().forEach((function(e){var n=N(e);I(n,t)}))}(e,n),document.querySelector(".loading").classList.remove("loading_active")}))})).catch((function(e){console.log(e)})),s.addEventListener("click",(function(){_.value=E.textContent,y.value=L.textContent,q(o)})),u.addEventListener("click",(function(){q(a)})),g.addEventListener("click",(function(){q(i)})),g.addEventListener("error",(function(){g.setAttribute("src",e)})),m.addEventListener("submit",(function(e){e.preventDefault(),O(!0,e),function(e,t){return j("".concat(D.baseUrl,"/users/me"),{method:"PATCH",headers:D.headers,body:JSON.stringify({name:e,about:t})})}(_.value,y.value).then((function(e){E.textContent=e.name,L.textContent=e.about,C(o)})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)}))})),p.addEventListener("submit",(function(e){e.preventDefault(),O(!0,e),function(e,t){return j("".concat(D.baseUrl,"/cards"),{method:"POST",headers:D.headers,body:JSON.stringify({name:e,link:t})})}(h.value,b.value).then((function(t){I(N(t),n),C(a),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)}))})),v.addEventListener("submit",(function(e){var t;e.preventDefault(),O(!0,e),(t=S.value,j("".concat(D.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:D.headers,body:JSON.stringify({avatar:t})})).then((function(t){g.src=t.avatar,C(i),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){O(!1,e)}))})),T={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button-submit_disable",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"},(U=Array.from(document.querySelectorAll(T.formSelector))).forEach((function(e){e.setAttribute("novalidate",!0)})),U.forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);k(n,r,t),e.addEventListener("reset",(function(){setTimeout((function(){k(n,r,t)}),0)})),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector("#".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(e,t,t.validationMessage,n)}(e,o,t),k(n,r,t)}))}))}(e,T)}))})();